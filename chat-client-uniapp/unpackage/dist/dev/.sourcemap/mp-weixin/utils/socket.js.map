{"version":3,"file":"socket.js","sources":["utils/socket.js"],"sourcesContent":["let socketTask = null;\n\nexport function connectSocket(userId, onMessage) {\n    socketTask = uni.connectSocket({\n        url: 'ws://192.168.110.238:9326', // ËØ∑ÊõøÊç¢Êàê‰Ω†ÁöÑÂ±ÄÂüüÁΩëIPÂíåÁ´ØÂè£\n        success() {\n            console.log(' WebSocket ËøûÊé•ÊàêÂäü');\n        },\n        fail(err) {\n            console.error(' WebSocket ËøûÊé•Â§±Ë¥•', err);\n        }\n    });\n\n    socketTask.onOpen(() => {\n        console.log('üì° WebSocket Â∑≤ÊâìÂºÄ');\n        // ÁôªÂΩïÁªëÂÆö userIdÔºåÊâÅÂπ≥ÁªìÊûÑ\n        const loginData = {\n            cmd: 1,\n            from: userId\n        };\n        socketTask.send({ data: JSON.stringify(loginData) });\n    });\n\n    socketTask.onMessage((res) => {\n        const dataStr = res.data;\n        if (!dataStr || dataStr === 'null' || dataStr === 'undefined') {\n            console.warn('Êî∂Âà∞Êó†ÊïàÊ∂àÊÅØ:', dataStr);\n            return;\n        }\n        try {\n            const data = JSON.parse(dataStr);\n            onMessage && onMessage(data);\n        } catch (e) {\n            console.error('Ê∂àÊÅØËß£ÊûêÈîôËØØ', e, dataStr);\n        }\n    });\n\n    socketTask.onClose(() => {\n        console.log('WebSocket Â∑≤ÂÖ≥Èó≠');\n    });\n\n    socketTask.onError((err) => {\n        console.error('WebSocket ÈîôËØØ', err);\n    });\n}\n\nexport function sendMsg(toUserId, msg, fromUserId) {\n    const data = {\n        cmd: 2,\n        type: \"private\",\n        from: fromUserId,\n        to: toUserId,\n        message: msg,\n        timestamp: Date.now()\n    };\n    // ÂêéÁ´ØÂ§ÑÁêÜjsonÊ†ºÂºèÔºåÊâÄ‰ª•ÈÄöËøáJSON.stringify()Â∞ÜjsÂØπË±°Ê†ºÂºèËΩ¨‰∏∫json\n    socketTask.send({ data: JSON.stringify(data) });\n}"],"names":["uni"],"mappings":";;AAAA,IAAI,aAAa;AAEV,SAAS,cAAc,QAAQ,WAAW;AAC7C,eAAaA,cAAG,MAAC,cAAc;AAAA,IAC3B,KAAK;AAAA;AAAA,IACL,UAAU;AACNA,oBAAAA,MAAA,MAAA,OAAA,wBAAY,iBAAiB;AAAA,IAChC;AAAA,IACD,KAAK,KAAK;AACNA,oBAAA,MAAA,MAAA,SAAA,yBAAc,mBAAmB,GAAG;AAAA,IACvC;AAAA,EACT,CAAK;AAED,aAAW,OAAO,MAAM;AACpBA,kBAAAA,MAAY,MAAA,OAAA,yBAAA,kBAAkB;AAE9B,UAAM,YAAY;AAAA,MACd,KAAK;AAAA,MACL,MAAM;AAAA,IAClB;AACQ,eAAW,KAAK,EAAE,MAAM,KAAK,UAAU,SAAS,EAAC,CAAE;AAAA,EAC3D,CAAK;AAED,aAAW,UAAU,CAAC,QAAQ;AAC1B,UAAM,UAAU,IAAI;AACpB,QAAI,CAAC,WAAW,YAAY,UAAU,YAAY,aAAa;AAC3DA,oBAAA,MAAA,MAAA,QAAA,yBAAa,WAAW,OAAO;AAC/B;AAAA,IACH;AACD,QAAI;AACA,YAAM,OAAO,KAAK,MAAM,OAAO;AAC/B,mBAAa,UAAU,IAAI;AAAA,IAC9B,SAAQ,GAAG;AACRA,oBAAc,MAAA,MAAA,SAAA,yBAAA,UAAU,GAAG,OAAO;AAAA,IACrC;AAAA,EACT,CAAK;AAED,aAAW,QAAQ,MAAM;AACrBA,kBAAAA,MAAA,MAAA,OAAA,yBAAY,eAAe;AAAA,EACnC,CAAK;AAED,aAAW,QAAQ,CAAC,QAAQ;AACxBA,kBAAA,MAAA,MAAA,SAAA,yBAAc,gBAAgB,GAAG;AAAA,EACzC,CAAK;AACL;AAEO,SAAS,QAAQ,UAAU,KAAK,YAAY;AAC/C,QAAM,OAAO;AAAA,IACT,KAAK;AAAA,IACL,MAAM;AAAA,IACN,MAAM;AAAA,IACN,IAAI;AAAA,IACJ,SAAS;AAAA,IACT,WAAW,KAAK,IAAK;AAAA,EAC7B;AAEI,aAAW,KAAK,EAAE,MAAM,KAAK,UAAU,IAAI,EAAC,CAAE;AAClD;;;"}