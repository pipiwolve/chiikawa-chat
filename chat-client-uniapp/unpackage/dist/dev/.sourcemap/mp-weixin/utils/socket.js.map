{"version":3,"file":"socket.js","sources":["utils/socket.js"],"sourcesContent":["let socketTask = null;\n\nexport function connectSocket(userId, onMessage) {\n    socketTask = uni.connectSocket({\n        url: 'ws://192.168.110.238:9326', // è¯·æ›¿æ¢æˆä½ çš„å±€åŸŸç½‘IPå’Œç«¯å£\n        success() {\n            console.log('âœ… WebSocket è¿žæŽ¥æˆåŠŸ');\n        },\n        fail(err) {\n            console.error('âŒ WebSocket è¿žæŽ¥å¤±è´¥', err);\n        }\n    });\n\n    socketTask.onOpen(() => {\n        console.log('ðŸ“¡ WebSocket å·²æ‰“å¼€');\n        // ç™»å½•ç»‘å®š userIdï¼Œæ‰å¹³ç»“æž„\n        const loginData = {\n            cmd: 1,\n            from: userId\n        };\n        socketTask.send({ data: JSON.stringify(loginData) });\n    });\n\n    socketTask.onMessage((res) => {\n        const dataStr = res.data;\n        if (!dataStr || dataStr === 'null' || dataStr === 'undefined') {\n            console.warn('æ”¶åˆ°æ— æ•ˆæ¶ˆæ¯:', dataStr);\n            return;\n        }\n        try {\n            const data = JSON.parse(dataStr);\n            onMessage && onMessage(data);\n        } catch (e) {\n            console.error('æ¶ˆæ¯è§£æžé”™è¯¯', e, dataStr);\n        }\n    });\n\n    socketTask.onClose(() => {\n        console.log('WebSocket å·²å…³é—­');\n    });\n\n    socketTask.onError((err) => {\n        console.error('WebSocket é”™è¯¯', err);\n    });\n}\n\nexport function sendMsg(toUserId, msg, fromUserId) {\n    const data = {\n        cmd: 2,\n        type: \"private\",\n        from: fromUserId,\n        to: toUserId,\n        message: msg,\n        timestamp: Date.now()\n    };\n    socketTask.send({ data: JSON.stringify(data) });\n}"],"names":["uni"],"mappings":";;AAAA,IAAI,aAAa;AAEV,SAAS,cAAc,QAAQ,WAAW;AAC7C,eAAaA,cAAG,MAAC,cAAc;AAAA,IAC3B,KAAK;AAAA;AAAA,IACL,UAAU;AACNA,oBAAAA,MAAA,MAAA,OAAA,wBAAY,kBAAkB;AAAA,IACjC;AAAA,IACD,KAAK,KAAK;AACNA,oBAAc,MAAA,MAAA,SAAA,yBAAA,oBAAoB,GAAG;AAAA,IACxC;AAAA,EACT,CAAK;AAED,aAAW,OAAO,MAAM;AACpBA,kBAAAA,MAAY,MAAA,OAAA,yBAAA,kBAAkB;AAE9B,UAAM,YAAY;AAAA,MACd,KAAK;AAAA,MACL,MAAM;AAAA,IAClB;AACQ,eAAW,KAAK,EAAE,MAAM,KAAK,UAAU,SAAS,EAAC,CAAE;AAAA,EAC3D,CAAK;AAED,aAAW,UAAU,CAAC,QAAQ;AAC1B,UAAM,UAAU,IAAI;AACpB,QAAI,CAAC,WAAW,YAAY,UAAU,YAAY,aAAa;AAC3DA,oBAAA,MAAA,MAAA,QAAA,yBAAa,WAAW,OAAO;AAC/B;AAAA,IACH;AACD,QAAI;AACA,YAAM,OAAO,KAAK,MAAM,OAAO;AAC/B,mBAAa,UAAU,IAAI;AAAA,IAC9B,SAAQ,GAAG;AACRA,oBAAc,MAAA,MAAA,SAAA,yBAAA,UAAU,GAAG,OAAO;AAAA,IACrC;AAAA,EACT,CAAK;AAED,aAAW,QAAQ,MAAM;AACrBA,kBAAAA,MAAA,MAAA,OAAA,yBAAY,eAAe;AAAA,EACnC,CAAK;AAED,aAAW,QAAQ,CAAC,QAAQ;AACxBA,kBAAA,MAAA,MAAA,SAAA,yBAAc,gBAAgB,GAAG;AAAA,EACzC,CAAK;AACL;AAEO,SAAS,QAAQ,UAAU,KAAK,YAAY;AAC/C,QAAM,OAAO;AAAA,IACT,KAAK;AAAA,IACL,MAAM;AAAA,IACN,MAAM;AAAA,IACN,IAAI;AAAA,IACJ,SAAS;AAAA,IACT,WAAW,KAAK,IAAK;AAAA,EAC7B;AACI,aAAW,KAAK,EAAE,MAAM,KAAK,UAAU,IAAI,EAAC,CAAE;AAClD;;;"}